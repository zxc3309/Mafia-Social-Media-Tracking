name: Simple Railway Trigger

on:
  # æ¯å¤©æ—©ä¸Š 9:00 CST (UTC 1:00)
  schedule:
    - cron: '0 1 * * *'
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  trigger-deployment:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger Railway Deployment
        run: |
          echo "ğŸš€ Triggering Railway deployment at $(date)"
          
          # ç›´æ¥ä½¿ç”¨ GitHub API è§¸ç™¼ repository dispatch
          # é€™å€‹æ–¹æ³•ç¬¬ä¸€æ¬¡æˆåŠŸé
          echo "ğŸ“¡ Sending deployment trigger via GitHub..."
          
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/repos/${{ github.repository }}/dispatches" \
            -d '{"event_type":"trigger-railway-collection"}'
          
          echo "âœ… GitHub dispatch event sent"
          
          # çµ¦ Railway ä¸€äº›æ™‚é–“ä¾†æª¢æ¸¬è®Šæ›´
          echo "â° Waiting for Railway to detect changes..."
          sleep 5
          
          echo "ğŸ“Š Deployment should start soon. Check Railway logs for status"
          echo "ğŸ’¡ Note: Railway may take 1-2 minutes to start the deployment"
      
      - name: Alternative - Use Railway GraphQL API
        if: failure()
        run: |
          echo "ğŸ”„ Trying Railway GraphQL API..."
          
          # å‰µå»ºä¸€å€‹æ–°çš„éƒ¨ç½²ä¾†è§¸ç™¼åŸ·è¡Œ
          curl -X POST \
            "https://backboard.railway.app/graphql/v2" \
            -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "query": "mutation { deploymentCreate(input: { projectId: \"${{ secrets.RAILWAY_PROJECT_ID }}\", environmentId: \"production\", serviceId: \"${{ secrets.RAILWAY_SERVICE_ID }}\" }) { id } }"
            }'
          
          echo "âœ… Deployment created via API"