name: Fallback Daily Collection

on:
  # æ¯å¤©æ—©ä¸Š 9:00 CST (UTC 1:00) 
  schedule:
    - cron: '0 1 * * *'
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  trigger-via-api:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger Railway via API
        run: |
          echo "ğŸš€ ä½¿ç”¨ Railway API è§¸ç™¼æ•¸æ“šæ”¶é›†..."
          
          # ä½¿ç”¨ curl ç›´æ¥èª¿ç”¨ Railway API
          response=$(curl -s -X POST \
            "https://backboard.railway.app/graphql/v2" \
            -H "Authorization: Bearer ${{ secrets.RAILWAY_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "query": "mutation ($serviceId: String!, $command: String!) { serviceInstanceRunCommand(serviceId: $serviceId, command: $command) { id } }",
              "variables": {
                "serviceId": "${{ secrets.RAILWAY_SERVICE_ID }}",
                "command": "python main.py --run-once"
              }
            }')
          
          echo "API Response: $response"
          
          if echo "$response" | grep -q "serviceInstanceRunCommand"; then
            echo "âœ… æˆåŠŸè§¸ç™¼æ•¸æ“šæ”¶é›†ä»»å‹™"
          else
            echo "âŒ è§¸ç™¼å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Railway æ—¥èªŒ"
            exit 1
          fi
      
      - name: Alternative Method - Direct HTTP
        if: failure()
        run: |
          echo "ğŸ”„ å˜—è©¦å‚™ç”¨æ–¹æ³•..."
          
          # ä½¿ç”¨ webhook æˆ–å…¶ä»–æ–¹å¼è§¸ç™¼
          # é€™è£¡å¯ä»¥æ·»åŠ å…¶ä»–å‚™ç”¨è§¸ç™¼æ–¹æ³•
          
          echo "ğŸ“Š è«‹æª¢æŸ¥ Railway æ—¥èªŒç¢ºèªåŸ·è¡Œç‹€æ…‹"