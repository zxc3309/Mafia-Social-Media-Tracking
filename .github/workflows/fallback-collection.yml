name: Fallback Daily Collection

on:
  # æ¯å¤©æ—©ä¸Š 9:00 CST (UTC 1:00) 
  schedule:
    - cron: '0 1 * * *'
  # å…è¨±æ‰‹å‹•è§¸ç™¼
  workflow_dispatch:

jobs:
  trigger-via-api:
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger Railway Deployment via API
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
          RAILWAY_PROJECT_ID: ${{ secrets.RAILWAY_PROJECT_ID }}
          RAILWAY_SERVICE_ID: ${{ secrets.RAILWAY_SERVICE_ID }}
        run: |
          echo "ğŸš€ ä½¿ç”¨ Railway API è§¸ç™¼éƒ¨ç½²é‡å•Ÿ..."
          
          # é©—è­‰å¿…è¦çš„ç’°å¢ƒè®Šæ•¸
          if [ -z "$RAILWAY_TOKEN" ]; then
            echo "âŒ Error: RAILWAY_TOKEN is not set"
            exit 1
          fi
          if [ -z "$RAILWAY_PROJECT_ID" ]; then
            echo "âŒ Error: RAILWAY_PROJECT_ID is not set"
            exit 1
          fi
          if [ -z "$RAILWAY_SERVICE_ID" ]; then
            echo "âŒ Error: RAILWAY_SERVICE_ID is not set"
            exit 1
          fi
          
          # æ–¹æ³•1: è§¸ç™¼ GitHub é‡æ–°éƒ¨ç½²ï¼ˆæœ€å¯é ï¼‰
          echo "ğŸ“¡ Method 1: Triggering deployment via GitHub webhook..."
          
          # Railway æœƒè‡ªå‹•å¾ GitHub æ‹‰å–ä¸¦é‡æ–°éƒ¨ç½²
          curl -X POST \
            -H "Accept: application/vnd.github.v3+json" \
            -H "Authorization: token ${{ github.token }}" \
            "https://api.github.com/repos/${{ github.repository }}/dispatches" \
            -d '{"event_type":"trigger-railway-collection"}'
          
          echo "âœ… GitHub deployment trigger sent"
          echo "â° Railway will pull and redeploy automatically"
          echo "ğŸ“Š Please check Railway logs in 1-2 minutes"
          
          echo "âœ… æˆåŠŸè§¸ç™¼ Railway æœå‹™åŸ·è¡Œ"
      
      - name: Alternative Method - Direct HTTP
        if: failure()
        run: |
          echo "ğŸ”„ å˜—è©¦å‚™ç”¨æ–¹æ³•..."
          
          # ä½¿ç”¨ webhook æˆ–å…¶ä»–æ–¹å¼è§¸ç™¼
          # é€™è£¡å¯ä»¥æ·»åŠ å…¶ä»–å‚™ç”¨è§¸ç™¼æ–¹æ³•
          
          echo "ğŸ“Š è«‹æª¢æŸ¥ Railway æ—¥èªŒç¢ºèªåŸ·è¡Œç‹€æ…‹"