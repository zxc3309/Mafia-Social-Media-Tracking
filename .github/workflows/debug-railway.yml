name: Debug Railway Connection

on:
  workflow_dispatch:

jobs:
  debug-railway:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check Secrets
        run: |
          echo "ğŸ” æª¢æŸ¥ Secrets é…ç½®..."
          echo "RAILWAY_TOKEN length: ${#RAILWAY_TOKEN}"
          echo "RAILWAY_SERVICE_ID: ${{ secrets.RAILWAY_SERVICE_ID }}"
          echo "RAILWAY_ENVIRONMENT_ID: ${{ secrets.RAILWAY_ENVIRONMENT_ID }}"
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
      
      - name: Install Railway CLI
        run: |
          echo "ğŸ“¦ å®‰è£ Railway CLI..."
          npm install -g @railway/cli
          railway --version
      
      - name: Test Railway Connection
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          echo "ğŸ”Œ æ¸¬è©¦ Railway é€£æ¥..."
          echo "Token length: ${#RAILWAY_TOKEN}"
          
          # æ¸¬è©¦åŸºæœ¬é€£æ¥
          if [ -n "${{ secrets.RAILWAY_SERVICE_ID }}" ]; then
            echo "ä½¿ç”¨ Service ID: ${{ secrets.RAILWAY_SERVICE_ID }}"
            railway whoami || echo "èªè­‰å¤±æ•—"
          elif [ -n "${{ secrets.RAILWAY_ENVIRONMENT_ID }}" ]; then
            echo "ä½¿ç”¨ Environment ID: ${{ secrets.RAILWAY_ENVIRONMENT_ID }}"
            railway whoami || echo "èªè­‰å¤±æ•—"
          else
            echo "âŒ ç¼ºå°‘ RAILWAY_SERVICE_ID æˆ– RAILWAY_ENVIRONMENT_ID"
          fi
      
      - name: Test Simple Command
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          echo "ğŸ§ª æ¸¬è©¦ç°¡å–®å‘½ä»¤..."
          if [ -n "${{ secrets.RAILWAY_SERVICE_ID }}" ]; then
            railway run echo "Railway connection successful!" --service ${{ secrets.RAILWAY_SERVICE_ID }}
          else
            railway run echo "Railway connection successful!"
          fi