name: Daily Social Media Collection

on:
  # 每天早上 9:00 CST (UTC 1:00)
  schedule:
    - cron: '0 1 * * *'
  # 允許手動觸發
  workflow_dispatch:

jobs:
  trigger-collection:
    runs-on: ubuntu-latest
    
    steps:
      - name: Install Railway CLI
        run: |
          # 安裝特定版本的 Railway CLI 確保一致性
          npm install -g @railway/cli@3.5.2
          echo "Railway CLI version: $(railway --version)"
      
      - name: Execute Collection via Railway CLI
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          echo "🚀 Triggering data collection at $(date)"
          # 使用 Railway CLI 直接執行收集任務
          if [ -n "${{ secrets.RAILWAY_SERVICE_ID }}" ]; then
            # 如果有 service ID，使用特定服務
            railway run python main.py --run-once --service ${{ secrets.RAILWAY_SERVICE_ID }}
          else
            # 否則在項目環境中執行
            railway run python main.py --run-once
          fi
          echo "✅ Collection task completed at $(date)"
      
      - name: Check Collection Status
        run: |
          echo "📊 Collection executed successfully"
          echo "Please check Railway logs and Google Sheets for results"