name: Daily Social Media Collection

on:
  # 每天早上 9:00 CST (UTC 1:00)
  schedule:
    - cron: '0 1 * * *'
  # 允許手動觸發
  workflow_dispatch:

jobs:
  trigger-collection:
    runs-on: ubuntu-latest
    
    steps:
      - name: Install Railway CLI
        run: |
          npm install -g @railway/cli
          echo "Railway CLI installed successfully"
      
      - name: Execute Collection via Railway CLI
        run: |
          echo "🚀 Triggering data collection at $(date)"
          # 使用 Railway CLI 直接執行收集任務
          if [ -n "${{ secrets.RAILWAY_SERVICE_ID }}" ]; then
            # 如果有 service ID，使用特定服務
            railway run --token ${{ secrets.RAILWAY_TOKEN }} \
                       --service ${{ secrets.RAILWAY_SERVICE_ID }} \
                       python main.py --run-once
          else
            # 否則在項目環境中執行
            railway run --token ${{ secrets.RAILWAY_TOKEN }} \
                       --environment ${{ secrets.RAILWAY_ENVIRONMENT_ID }} \
                       python main.py --run-once
          fi
          echo "✅ Collection task completed at $(date)"
      
      - name: Check Collection Status
        run: |
          echo "📊 Collection executed successfully"
          echo "Please check Railway logs and Google Sheets for results"